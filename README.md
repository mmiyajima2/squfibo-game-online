# SquFibo（すくふぃぼ） - オンライン対戦版

**置いた一手で「気づけた子」が得をする、暗算とひらめきの数字ゲーム**

## 概要

SquFiboは、小学生の「考える力」を育てるための2人対戦ブラウザゲームです。3×3の盤面に数字カードを配置し、特定の組み合わせ（役）を作って星を獲得します。暗算力や知識量では測れない「気づく力・盤面全体を見る力」を、遊びの中で自然に引き出す学習体験を提供します。

## ゲームの特徴

- **気づく力を育てる**: 役の自動判定は行わず、気づいたプレイヤーだけが申告できる
- **脱落や強い罰がない**: 手札が0枚になっても脱落せず、ゲームを続けられる
- **シンプルでわかりやすい**: 3×3の盤面と4種類の数字カードのみ
- **読み合いが生まれる**: 盤面をどう相手に渡すか、戦略的な判断が求められる
- **気づけた瞬間が楽しい**: 勝敗より「気づけた回数・早さ」が自然にスコア差として表れる
- **デジタル/物理対応**: ブラウザゲームとしても、物理ボードゲームとしても遊べる設計

## ゲームルール概要

### 使用要素
- **数字カード**:
  - 赤1×4、青1×4
  - 赤4×4、青4×4
  - 赤9×9、青9×9
  - 赤16×4、青16×4
  - 合計46枚
- **盤面**: 3×3のマス（固定）
- **星**: 21個（得点トークン）
- **山札**: シャッフルされたカードのデッキ

### ゲーム開始
1. 数字カードをすべてシャッフルする
2. 各プレイヤーに手札を8枚配る
3. 残りのカードを山札（デッキ）とする
4. 星（21個）をすべて場に用意する

### ターンの流れ
1. 盤面がすべて埋まっている場合、好きなマスのカードを1枚捨て札にする
2. 手札からカードを1枚選び、盤面の空いているマスに配置する
   - 手札が0枚の場合は、山札から1枚引いてそのまま配置
3. 今回置いたカードを含む役が成立していれば、1つだけ申告できる
4. 役が正しければ：
   - 役に使ったカードを盤面から除去し、捨て札にする
   - 除去したカードの枚数だけ山札からカードを引く
   - 除去したカードの枚数またはそれに応じた星を獲得
5. 役を申告しない、または成立していなければ手番終了

### ゲーム終了
- 以下のいずれかの条件を満たしたらゲーム終了：
  1. 場に用意された星がすべて獲得された
  2. 山札が0枚になった
- 星が最も多いプレイヤーが勝利（同点の場合は引き分け）

### 役の種類

**重要**:
- 役は同色のカードのみで成立
- 役のカードは盤面上で隣接（縦または横）している必要がある
- 必ず今回置いたカードを含むこと
- 1ターンに申告できる役は1つのみ

#### 大役
- **1 + 4 + 16**: 3枚除去、3枚ドロー、星3個
  - 配置形状：縦に3枚連なる、横に3枚連なる、またはL字型に連なる
  - 和がフィボナッチ数（21）になる組み合わせ

#### 小役
- **同じ数字・同じ色の3枚**: 3枚除去、1枚ドロー、星1個
  - 配置形状：縦に3枚連なる、横に3枚連なる、またはL字型に連なる
  - 例：赤9×3枚、青4×3枚など

詳細なルールは [docs/game_spec_ja.md](docs/game_spec_ja.md) を参照してください。

## 技術スタック

### クライアント
- **フロントエンド**: Vite + React 19 + TypeScript
- **テスト**: Vitest
- **Linter**: ESLint
- **分析**: Google Analytics 4 (react-ga4)

### サーバー
- **バックエンド**: Express.js + Socket.IO
- **データストア**: Redis

## プロジェクト構造

```
squfibo-game-online/
├── client/         # フロントエンドアプリケーション (React + TypeScript)
├── server/         # バックエンドサーバー (Express.js + Socket.IO)
├── shared/         # クライアント・サーバー間の共有コード
├── docs/           # ドキュメント (game_spec_ja.md など)
├── LICENSE         # MITライセンス
└── README.md       # このファイル
```

## セットアップ

### 前提条件
- Node.js 18.x 以上
- npm または yarn
- Redis (サーバー実行時に必要)

### インストール

```bash
# リポジトリをクローン
git clone https://github.com/your-org/squfibo-game-online.git
cd squfibo-game-online

# クライアントの依存関係をインストール
cd client
npm install

# サーバーの依存関係をインストール (準備中)
cd ../server
npm install
```

## 開発方法

### クライアント開発

```bash
cd client

# 開発サーバーを起動 (ホットリロード有効)
npm run dev

# リンターを実行
npm run lint

# テストを実行
npm run test

# テストをウォッチモードで実行
npm run test:watch

# テストUIを起動
npm run test:ui
```

開発サーバーは `http://localhost:5173` で起動します。

### プロダクションビルド

```bash
cd client

# TypeScriptのコンパイルとViteビルドを実行
npm run build

# ビルド結果をプレビュー
npm run preview
```

## テスト

プロジェクトではVitestを使用した単体テストを実装しています。

- `npm run test` - テストを一度実行
- `npm run test:watch` - ファイル変更を監視して自動実行
- `npm run test:ui` - ブラウザでテストUIを起動

## 貢献

バグ報告や機能提案は、GitHubのIssuesでお願いします。プルリクエストも歓迎します。

## ライセンス

このプロジェクトは[MITライセンス](LICENSE)の下で公開されています。

## 著作権

Copyright (c) 2026 SquFibo Project Contributors

本ソフトウェアは著作権法により保護されています。
